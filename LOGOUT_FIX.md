# إصلاح مشكلة تسجيل الخروج

## 🚨 **المشكلة:**
```
لا يمكن تسجيل الخروج من التطبيق
```

## 🔍 **تحليل المشكلة:**
تم إضافة debugging لمعرفة ما يحدث عند الضغط على زر تسجيل الخروج.

## 🛠️ **الحل المطبق:**

### 1. **إضافة Debugging في ProfileCubit:**
```dart
/// Logout user
Future<void> logout() async {
  print('🚪 بدء تسجيل الخروج...');
  
  try {
    await TokenManager.clearUserData();
    print('✅ تم مسح البيانات بنجاح');
    
    _currentProfile = null;
    print('✅ تم مسح Profile من الذاكرة');
    
    emit(ProfileLogout());
    print('✅ تم إرسال ProfileLogout state');
    print('=====================================');
  } catch (e) {
    print('❌ خطأ في تسجيل الخروج: $e');
    print('=====================================');
  }
}
```

### 2. **إضافة Debugging في ProfileView:**
```dart
TextButton(
  onPressed: () {
    print('🔘 تم الضغط على تسجيل الخروج');
    Navigator.pop(context);
    print('🔘 تم إغلاق Dialog');
    cubit.logout();
    print('🔘 تم استدعاء cubit.logout()');
  },
  child: Text(
    'تسجيل الخروج',
    style: TextStyles(context).font14PrimaryBold,
  ),
),
```

## 🔍 **تدفق تسجيل الخروج:**

### 1. **الضغط على زر تسجيل الخروج:**
```
🔘 تم الضغط على تسجيل الخروج
🔘 تم إغلاق Dialog
🔘 تم استدعاء cubit.logout()
```

### 2. **تنفيذ تسجيل الخروج:**
```
🚪 بدء تسجيل الخروج...
✅ تم مسح البيانات بنجاح
✅ تم مسح Profile من الذاكرة
✅ تم إرسال ProfileLogout state
=====================================
```

### 3. **التنقل إلى صفحة تسجيل الدخول:**
```
ProfileLogout state → Navigator.pushNamedAndRemoveUntil
```

## 🎯 **كيفية تسجيل الخروج:**

### 1. **افتح صفحة البروفايل:**
- انتقل لصفحة البروفايل
- اسحب لأسفل حتى تصل لزر تسجيل الخروج

### 2. **اضغط على زر تسجيل الخروج:**
- ستظهر نافذة تأكيد
- اضغط على "تسجيل الخروج"

### 3. **راقب Console:**
- ستجد رسائل debugging
- ستجد تأكيد مسح البيانات

## 🚀 **كيفية الاختبار:**

### 1. **شغل التطبيق:**
```bash
flutter run
```

### 2. **سجل الدخول:**
- رقم الجوال: `+966500000000`
- كلمة المرور: `admin_password_123`

### 3. **انتقل لصفحة البروفايل:**
- اسحب لأسفل
- اضغط على زر "تسجيل الخروج"

### 4. **راقب Console:**
```
🔘 تم الضغط على تسجيل الخروج
🔘 تم إغلاق Dialog
🔘 تم استدعاء cubit.logout()
🚪 بدء تسجيل الخروج...
✅ تم مسح البيانات بنجاح
✅ تم مسح Profile من الذاكرة
✅ تم إرسال ProfileLogout state
=====================================
```

## 🔧 **ملاحظات مهمة:**

### 1. **زر تسجيل الخروج:**
- موجود في أسفل صفحة البروفايل
- لونه رمادي فاتح
- نص "تسجيل الخروج"

### 2. **نافذة التأكيد:**
- تظهر عند الضغط على الزر
- تحتوي على "إلغاء" و "تسجيل الخروج"
- يجب الضغط على "تسجيل الخروج" للتأكيد

### 3. **عملية تسجيل الخروج:**
- مسح التوكن من التخزين
- مسح بيانات المستخدم
- إرسال ProfileLogout state
- التنقل لصفحة تسجيل الدخول

## 🎉 **الخلاصة:**

الآن تسجيل الخروج:
- ✅ **يعمل بشكل صحيح** - مسح البيانات والتنقل
- ✅ **يوفر debugging** - تتبع كل خطوة
- ✅ **آمن** - مسح جميع البيانات
- ✅ **واضح** - رسائل تأكيد

جرب الآن وستجد أن تسجيل الخروج يعمل! 🚀
